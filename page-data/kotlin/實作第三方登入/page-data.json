{"componentChunkName":"component---src-templates-blog-post-js","path":"/kotlin/å¯¦ä½œç¬¬ä¸‰æ–¹ç™»å…¥/","result":{"data":{"site":{"siteMetadata":{"title":"Travel in Time.","author":"Zoe Yu"}},"markdownRemark":{"id":"4d0832dc-e6b8-5ec9-a5a6-e1bd6c89a141","excerpt":"ä¹‹å‰ side-project æœ‰ç¨å¾®ç ”ç©¶ï¼Œæœ€è¿‘æ¡ˆå­éœ€æ±‚åˆé‡æ–°çœ‹äº†ä¸€æ¬¡ï¼Œä¹¾è„†æ•´ç†èµ·ä¾†ã€‚ æ•´é«”ä¾†èªªï¼ŒFacebook ç¬¬ä¸‰æ–¹ç™»å…¥ç›¸å°å®¹æ˜“ï¼ŒGoogle å’Œ LINE å‰‡è¦èŠ±æ™‚é–“ç”³è«‹å¸³è™Ÿå’Œé©—è­‰ï¼Œéœ€è¦é€²è¡Œä¸å°‘æ­¥é©Ÿï¼Œç¶²è·¯ä¸Šè³‡æ–™å¾ˆå¤šï¼Œå°±æˆ‘è’é›†åˆ°æ¯”è¼ƒæ¸…æ¥šçš„éƒ¨åˆ†ä¾†å¯¦ä½œã€‚ Facebookâ€¦","html":"<p>ä¹‹å‰ side-project æœ‰ç¨å¾®ç ”ç©¶ï¼Œæœ€è¿‘æ¡ˆå­éœ€æ±‚åˆé‡æ–°çœ‹äº†ä¸€æ¬¡ï¼Œä¹¾è„†æ•´ç†èµ·ä¾†ã€‚</p>\n<p>æ•´é«”ä¾†èªªï¼Œ<a href=\"#Facebook%E7%B0%A1%E6%98%93%E7%99%BB%E5%85%A5%E5%81%9A%E6%B3%95\">Facebook ç¬¬ä¸‰æ–¹ç™»å…¥</a>ç›¸å°å®¹æ˜“ï¼Œ<a href=\"#Google%E7%99%BB%E5%85%A5\">Google</a> å’Œ <a href=\"#LINE%E7%99%BB%E5%85%A5\">LINE</a> å‰‡è¦èŠ±æ™‚é–“ç”³è«‹å¸³è™Ÿå’Œé©—è­‰ï¼Œéœ€è¦é€²è¡Œä¸å°‘æ­¥é©Ÿï¼Œç¶²è·¯ä¸Šè³‡æ–™å¾ˆå¤šï¼Œå°±æˆ‘è’é›†åˆ°æ¯”è¼ƒæ¸…æ¥šçš„éƒ¨åˆ†ä¾†å¯¦ä½œã€‚</p>\n<hr>\n<hr>\n<h2>Facebookç°¡æ˜“ç™»å…¥åšæ³•</h2>\n<p>åƒè€ƒé€™ç¯‡ <a href=\"https://developers.facebook.com/docs/facebook-login/android?locale=zh_TW\">Android å°ˆç”¨ Facebook ç™»å…¥</a>ï¼ŒåŸºæœ¬ä¸ŠæŒ‰ç…§æ–‡ä»¶ä¸€æ­¥ä¸€æ­¥å°±å¯ä»¥å®Œæˆ</p>\n<p>åœ¨ <strong>XML</strong> ä½¿ç”¨ï¼Œå·²åŒ…è£ LoginManager å¯ç”¨åŠŸèƒ½çš„ UI å…ƒä»¶</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> &lt;</span><span class=\"mtk12\">com</span><span class=\"mtk1\">.</span><span class=\"mtk12\">facebook</span><span class=\"mtk1\">.</span><span class=\"mtk12\">login</span><span class=\"mtk1\">.</span><span class=\"mtk12\">widget</span><span class=\"mtk1\">.</span><span class=\"mtk12\">LoginButton</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    android</span><span class=\"mtk15\">:</span><span class=\"mtk1\">id=</span><span class=\"mtk8\">&quot;@+id/btn_facebook_login&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    android</span><span class=\"mtk15\">:</span><span class=\"mtk1\">layout_width=</span><span class=\"mtk8\">&quot;300dp&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    android</span><span class=\"mtk15\">:</span><span class=\"mtk1\">layout_height=</span><span class=\"mtk8\">&quot;300dp&quot;</span><span class=\"mtk1\">/&gt;</span></span></span></code></pre>\n<p><strong>è¨»å†Š Callback</strong>\nåˆå§‹åŒ–æ™‚å»ºç«‹ CallbackManager</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">lateinit </span><span class=\"mtk4\">var</span><span class=\"mtk1\"> </span><span class=\"mtk12\">callbackManager</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk10\">CallbackManager</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">override fun </span><span class=\"mtk11\">onCreate</span><span class=\"mtk1\">(savedInstanceState</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Bundle</span><span class=\"mtk15\">?</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">super</span><span class=\"mtk1\">.</span><span class=\"mtk11\">onCreate</span><span class=\"mtk1\">(savedInstanceState)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">setContentView</span><span class=\"mtk1\">(</span><span class=\"mtk12\">R</span><span class=\"mtk1\">.</span><span class=\"mtk12\">layout</span><span class=\"mtk1\">.</span><span class=\"mtk12\">activity_login</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//å»ºç«‹ CallbackManager</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    callbackManager = </span><span class=\"mtk12\">CallbackManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Factory</span><span class=\"mtk1\">.</span><span class=\"mtk11\">create</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span></code></pre>\n<p>åœ¨ onCreate() æˆ– onCreateView() æ–¹æ³•ä¸­è¨»å†Šå›å‘¼ï¼Œè‡ªå®šç¾© LoginButtonï¼Œç™»å…¥æˆåŠŸï¼ŒLoginResult åƒæ•¸æœƒå…·æœ‰æ–°çš„ AccessToken </p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">loginButton</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setReadPermissions</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;email&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// å¦‚æœåœ¨ fragment ä¸­ä½¿ç”¨</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">loginButton</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setFragment</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// è¨»å†Šå›å‘¼</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">btn_facebook_login</span><span class=\"mtk1\">.</span><span class=\"mtk11\">registerCallback</span><span class=\"mtk1\">(callbackManager,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        object </span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk10\">FacebookCallback</span><span class=\"mtk1\">&lt;LoginResult&gt; {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            override fun </span><span class=\"mtk11\">onSuccess</span><span class=\"mtk1\">(result</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> LoginResult</span><span class=\"mtk15\">?</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// å–å¾— token å’Œ userID</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                val token = result!!.</span><span class=\"mtk12\">accessToken</span><span class=\"mtk1\">.</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toString</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                val userId = </span><span class=\"mtk12\">result</span><span class=\"mtk1\">.</span><span class=\"mtk12\">accessToken</span><span class=\"mtk1\">.</span><span class=\"mtk12\">userId</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toString</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            override fun </span><span class=\"mtk11\">onCancel</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            override fun </span><span class=\"mtk11\">onError</span><span class=\"mtk1\">(error</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> FacebookException</span><span class=\"mtk15\">?</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        })</span></span></span></code></pre>\n<p>è¦åœ¨ onActivityResult æ–¹å¼ä¸­å‘¼å« callbackManager.onActivityResultï¼Œæ‰å¯ä»¥å¾ LoginManager å–å¾—çµæœ</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">override fun </span><span class=\"mtk11\">onActivityResult</span><span class=\"mtk1\">(requestCode</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Int, resultCode</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Int, data</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Intent</span><span class=\"mtk15\">?</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">super</span><span class=\"mtk1\">.</span><span class=\"mtk11\">onActivityResult</span><span class=\"mtk1\">(requestCode, resultCode, data)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//callbackManager æœƒå°‡ç™»å…¥çµæœå‚³é€è‡³ LoginManager</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">callbackManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">onActivityResult</span><span class=\"mtk1\">(requestCode, resultCode, data)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><strong>&#x3C;å°šæœªä½¿ç”¨é></strong>\nä½¿ç”¨ SDK å¾å¿«å–æˆ–æ‡‰ç”¨ç¨‹å¼æ›¸ç±¤è¼‰å…¥ </p>\n<ul>\n<li>AccessToken.getCurrentAccessToken</li>\n<li>Profile.getCurrentProfile()</li>\n</ul>\n<p>åœ¨ç¨‹å¼é‡æ–°å•Ÿå‹•æ™‚ï¼Œæ–¼ Activity çš„ <code>onCreate</code> æ–¹æ³•ä¸­å…ˆæª¢æŸ¥æ˜¯å¦å·²ç™»å…¥ã€æ˜¯å¦ä»å…·æœ‰æ•ˆæ€§</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">val accessToken = </span><span class=\"mtk12\">AccessToken</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getCurrentAccessToken</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">val isLoggedIn</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk10\">boolean</span><span class=\"mtk1\"> = accessToken != </span><span class=\"mtk4\">null</span><span class=\"mtk1\"> &amp;&amp; !</span><span class=\"mtk12\">accessToken</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isExpired</span><span class=\"mtk1\">()</span></span></span></code></pre>\n<p>ä¹‹å¾Œä¾¿å¯åŸ·è¡Œå¯¦éš›ç™»å…¥ï¼Œä¾‹å¦‚å¯«åœ¨è‡ªè¨‚æŒ‰éˆ•çš„ <code>OnClickListener</code> ä¸­</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">LoginManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getInstance</span><span class=\"mtk1\">().</span><span class=\"mtk11\">logInWithReadPermissions</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">, </span><span class=\"mtk12\">Arrays</span><span class=\"mtk1\">.</span><span class=\"mtk11\">asList</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;public_profile&quot;</span><span class=\"mtk1\">));</span></span></span></code></pre>\n<hr>\n<h2>Googleç™»å…¥</h2>\n<p>æµç¨‹æ»¿å¤šï¼Œæœƒæœ‰é»è¤‡é›œï¼Œå¯ä»¥åƒè€ƒä¸‹é¢å…©ç¯‡ï¼Œå‰é¢çš„é…ç½®å°±ç•¥éï¼Œç­†è¨˜ä¸€ä¸‹æ­¥é©Ÿ</p>\n<ol>\n<li>\n<p><strong>XML</strong>è£¡é¢æ”¾ Google ç™»å…¥æŒ‰éˆ•ï¼Œ åªæœ‰æä¾›ç™»å…¥ã€æ²’æœ‰ç™»å‡ºæŒ‰éˆ•...åªå¥½è‡ªå·±åˆ»ä¸€å€‹</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;</span><span class=\"mtk12\">com</span><span class=\"mtk1\">.</span><span class=\"mtk12\">google</span><span class=\"mtk1\">.</span><span class=\"mtk12\">android</span><span class=\"mtk1\">.</span><span class=\"mtk12\">gms</span><span class=\"mtk1\">.</span><span class=\"mtk12\">common</span><span class=\"mtk1\">.</span><span class=\"mtk12\">SignInButton</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">android</span><span class=\"mtk15\">:</span><span class=\"mtk1\">id=</span><span class=\"mtk8\">&quot;@+id/btn_google_login&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">android</span><span class=\"mtk15\">:</span><span class=\"mtk1\">layout_width=</span><span class=\"mtk8\">&quot;wrap_content&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">android</span><span class=\"mtk15\">:</span><span class=\"mtk1\">layout_height=</span><span class=\"mtk8\">&quot;wrap_content&quot;</span><span class=\"mtk1\">/&gt;</span></span></span></code></pre>\n</li>\n<li>\n<p>åœ¨<code>build.gradle</code> implement</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">dependencies {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">implementation </span><span class=\"mtk8\">&#39;com.google.android.gms:play-services-auth:17.0.0&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">} </span></span></span></code></pre>\n</li>\n<li>é€™éƒ¨åˆ†å¯¦ä½œä¸»è¦æ˜¯åƒè€ƒé€™ä»½<a href=\"https://developers.google.com/identity/sign-in/android/sign-in#add_the_google_sign-in_button_to_your_app\">å®˜æ–¹æ–‡ä»¶</a>ï¼Œå¾—å…ˆå» <a href=\"https://console.developers.google.com/api\">Goodle APIs</a> æ–°å¢å°ˆæ¡ˆï¼Œå¦‚æœä½ å°ˆæ¡ˆå¼„å¥½ã€å»å¿˜äº†é…ç½®ä¸€äº›è³‡è¨Šï¼Œåœ¨ <a href=\"https://developers.google.com/identity/sign-in/android/start-integrating\">Try Sign-In for Android</a>è£œä¸Š\n<img src=\"https://i.imgur.com/xzksyPl.png\"></li>\n</ol>\n<p>é…ç½® Google API project\n<img src=\"https://i.imgur.com/9337nui.png\"></p>\n<p>è¦å¡«å…¥åŒ…åå’ŒSHA-1ï¼Œå®Œæˆé€™å…©å€‹æ‰æœƒæ‹¿åˆ° <strong>Client ID</strong>ï¼Œæœ‰å®ƒæ‰èƒ½å–å¾— Token å‘€ï¼</p>\n<ul>\n<li>åŒ…å(Package Name) åœ¨ <code>build.gradle</code> æ‰¾</li>\n<li>SHA-1 å€¼</li>\n</ul>\n<p><img src=\"https://i.imgur.com/XfpEgs6.png\"></p>\n<h3>å¦‚ä½•å–å¾— SHA-1 å€¼</h3>\n<p>ä¸ä¸€å®šè¦è¼¸å…¥æŒ‡ä»¤ï¼Œåªè¦åœ¨ Android Studio å³å´é»é¸ <code>Tasks -> Android -> SigningResport</code>å°±æœƒå‡ºç¾å›‰</p>\n<p><img src=\"https://i.imgur.com/kgVYTgS.png\"></p>\n<p><img src=\"https://i.imgur.com/xwjwOrK.png\"></p>\n<hr>\n<ol start=\"4\">\n<li>æ‹¿åˆ° Client ID ä¹‹å¾Œå°±å¯ä»¥å›åˆ°ç¨‹å¼ç¢¼ï¼Œç™»å…¥è¨­ç½®å¦‚ä¸‹ï¼Œå°±æ˜¯å¡«å…¥ \"serverClientId\"</li>\n</ol>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//Googleç™»å…¥</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">private</span><span class=\"mtk1\"> fun </span><span class=\"mtk11\">google_login</span><span class=\"mtk1\">(){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//å»ºç«‹ GoogleSignInOptions</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val mGoogleSignInOptions = </span><span class=\"mtk12\">GoogleSignInOptions</span><span class=\"mtk1\">.</span><span class=\"mtk11\">Builder</span><span class=\"mtk1\">(</span><span class=\"mtk12\">GoogleSignInOptions</span><span class=\"mtk1\">.</span><span class=\"mtk12\">DEFAULT_SIGN_IN</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">requestServerAuthCode</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;serverClientId&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">requestIdToken</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;serverClientId&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">requestEmail</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">build</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val mgoogleApiClient = </span><span class=\"mtk10\">GoogleApiClient</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">Builder</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">addApi</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Auth</span><span class=\"mtk1\">.</span><span class=\"mtk12\">GOOGLE_SIGN_IN_API</span><span class=\"mtk1\">, mGoogleSignInOptions)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">build</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val signInIntent= </span><span class=\"mtk12\">Auth</span><span class=\"mtk1\">.</span><span class=\"mtk12\">GoogleSignInApi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getSignInIntent</span><span class=\"mtk1\">(mgoogleApiClient)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">startActivityForResult</span><span class=\"mtk1\">(signInIntent, REQ_GOOGLE_LOGI)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>æˆ‘æä¸æ¸…æ¥š requestServerAuthCode å’Œ requestIdToken å·®åœ¨å“ªè£¡ï¼ŒæŸ¥äº†ä¸€ä¸‹æ‰çŸ¥é“ï¼Œ<a href=\"https://stackoverflow.com/questions/39668773/what-is-diff-between-requestidtoken-and-requestserverauthcode-in-google-singnin\">åƒè€ƒ</a></p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//Googleç™»å‡º</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">private</span><span class=\"mtk1\"> fun </span><span class=\"mtk11\">google_logOut</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val gso = </span><span class=\"mtk10\">GoogleSignInOptions</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">Builder</span><span class=\"mtk1\">(</span><span class=\"mtk12\">GoogleSignInOptions</span><span class=\"mtk1\">.</span><span class=\"mtk12\">DEFAULT_SIGN_IN</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">requestIdToken</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;serverClientId&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">requestEmail</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">build</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    mGoogleSignInClient = </span><span class=\"mtk12\">GoogleSignIn</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getClient</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">, gso)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">mGoogleSignInClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">signOut</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>æ¥æ”¶ Google å›å‚³çµæœ</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">override fun </span><span class=\"mtk11\">onActivityResult</span><span class=\"mtk1\">(requestCode</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Int, resultCode</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Int, data</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Intent</span><span class=\"mtk15\">?</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">super</span><span class=\"mtk1\">.</span><span class=\"mtk11\">onActivityResult</span><span class=\"mtk1\">(requestCode, resultCode, data)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (requestCode == REQ_GOOGLE_LOGIN &amp;&amp; data != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        val task = </span><span class=\"mtk12\">GoogleSignIn</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getSignedInAccountFromIntent</span><span class=\"mtk1\">(data)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">handleGoogleResult</span><span class=\"mtk1\">(task)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//è§£ægoogleå›å‚³çµæœ</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">private</span><span class=\"mtk1\"> fun </span><span class=\"mtk11\">handleGoogleResult</span><span class=\"mtk1\">(task</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Task</span><span class=\"mtk1\">&lt;GoogleSignInAccount&gt;) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val account = </span><span class=\"mtk12\">task</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getResult</span><span class=\"mtk1\">(ApiException</span><span class=\"mtk15\">::</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk12\">java</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val getEmail = account!!.</span><span class=\"mtk12\">email</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val getidToken = </span><span class=\"mtk12\">account</span><span class=\"mtk1\">.</span><span class=\"mtk12\">idToken</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//ç”±å¾Œç«¯å»é©—è­‰token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<hr>\n<h3>Googleç™»å…¥å•é¡Œ</h3>\n<ul>\n<li><strong><code>com.google.android.gms.common.api.ApiExceptionï¼š10</code> æä¾›æœªçŸ¥çš„å®¢æˆ·ç«¯ID</strong></li>\n</ul>\n<p>å‡ºç¾ <code>10</code> éŒ¯èª¤ç‚ºé…ç½®ä¸æ­£ç¢ºï¼Œè¡¨ç¤ºç‚ºé–‹ç™¼äººå“¡çš„éŒ¯èª¤ï¼Œå¯èƒ½æ²’æœ‰æä¾› SHA-1 æˆ–æ˜¯æœªå›æ‡‰å° idToken çš„è«‹æ±‚ï¼Œæª¢æŸ¥ <code>requestIdToken(getString(R.string.google_app_id))</code> æœ‰ç„¡æ­£ç¢ºå¡«å…¥ã€‚</p>\n<ul>\n<li><strong><code>com.google.android.gms.common.api.ApiExceptionï¼š12500</code></strong>\nä¸€ç›´å‡ºç¾ <code>12500</code> éŒ¯èª¤ï¼Œé€™å€‹çœŸçš„å¾ˆé›£åµéŒ¯åŸå› ï¼ŒèŠ±äº†å¿«å…©å€‹å°æ™‚æ‰æ‰¾åˆ°å•é¡Œè§£ç­”ï¼Œåƒè€ƒé€™ç¯‡ <a href=\"https://stackoverflow.com/questions/34068065/error-12500-in-google-sign-in-8-3-0-when-requesting-requestserverauthcode\">error 12500 in google sign in</a> æˆ– <a href=\"https://t.codebug.vip/questions-1254036.htm\">android:Firebase Google Authç„¡æ³•ä½¿ç”¨ ApiExceptionï¼š12500</a>ï¼Œç¶²ä¸Šçœ¾èªªç´›ç´œï¼Œç™¼ç¾è‡ªå·±æ˜¯å› ç‚ºå…©ç¨®éŒ¯èª¤è€Œé€ æˆï¼š</li>\n</ul>\n<hr>\n<p><strong>Web Client ID</strong> å‡ºéŒ¯</p>\n<ol>\n<li>æ‰“é–‹ <a href=\"https://console.developers.google.com/apis/\">Google API Console</a> å·¦ä¸Šè§’<strong>é¸æ“‡å°ˆæ¡ˆ</strong></li>\n<li>æŒ‰å·¦å´ã€Œæ†‘è­‰ã€ï¼Œæœƒçœ‹åˆ° OAuth 2.0 ç”¨æˆ¶ç«¯ ID</li>\n<li>ç¢ºä¿ä½ åœ¨ <code>requestServerAuthCode</code> æ–¹æ³•è£¡å¡«å…¥çš„æ˜¯ <strong>Web Client Id</strong>ï¼Œè€Œä¸æ˜¯ Android</li>\n</ol>\n<p>åŸå› å‡ºåœ¨è¼¸å…¥ SHA1 å¾Œæœƒç”¢ç”Ÿ <strong>Android</strong> å’Œ <strong>webclient</strong> å…©å€‹ Client IDï¼š\na SHA1 code created both an Android oauth client and a webclient in google developers console.</p>\n<p><img src=\"https://i.imgur.com/pMGwlBa.png\"></p>\n<hr>\n<p><strong>ä¸åŒçš„é™¤éŒ¯ SHA1-key</strong> å‡ºéŒ¯\næ‰¾äº†å¥½ä¹…æ‰ç™¼ç¾ android æœƒç”Ÿæˆä¸åŒçš„ SHA1 å€¼ï¼Œå› ç‚ºæˆ‘æ‰“åŒ…ç”¨çš„æ˜¯ release modeï¼Œä½†æ˜¯ä¸€ç›´å¡«åˆ° debug çš„ SHA1-key...</p>\n<p><img src=\"https://i.imgur.com/AYVt6FR.png\"></p>\n<hr>\n<h2>LINEç™»å…¥</h2>\n<p>Line ç™»å…¥å¯¦ä½œç¶²è·¯ä¸Šè³‡æ–™ä¸å¤šï¼Œæœ€å¥½å°±æ˜¯ç›´æ¥åƒè€ƒ<a href=\"https://developers.line.biz/en/docs/android-sdk/integrate-line-login/#add-line-sdk-dependency\">å®˜æ–¹ä½œæ³•</a></p>\n<ol>\n<li>åœ¨ <code>build.gradle</code> æ·»åŠ  LINE SDK</li>\n</ol>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">repositories {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">   ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">   </span><span class=\"mtk11\">jcenter</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">dependencies {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    implementation </span><span class=\"mtk8\">&#39;com.linecorp:linesdk:5.0.1&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">} </span></span></span></code></pre>\n<p>æ·»åŠ  Android ç·¨è­¯é …ç›®ï¼Œå¯ä½¿ç”¨<code>Java 1.8 support</code></p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">android {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  compileOptions {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        sourceCompatibility </span><span class=\"mtk12\">JavaVersion</span><span class=\"mtk1\">.</span><span class=\"mtk12\">VERSION_1_8</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        targetCompatibility </span><span class=\"mtk12\">JavaVersion</span><span class=\"mtk1\">.</span><span class=\"mtk12\">VERSION_1_8</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<ol start=\"2\">\n<li>å» <code>manifest</code> åŠ å…¥ç¶²è·¯æ¬Šé™</li>\n</ol>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;uses-permission android</span><span class=\"mtk15\">:</span><span class=\"mtk1\">name=</span><span class=\"mtk8\">&quot;android.permission.INTERNET&quot;</span><span class=\"mtk1\"> /&gt;</span></span></span></code></pre>\n<ol start=\"3\">\n<li>è¨­å®šæª”å¥½äº†å¾Œï¼Œæ¥è‘—åœ¨ <a href=\"https://developers.line.biz/zh-hant/?status=success\">LINE Developer</a> ç™»å…¥ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç™»å°±è¦è¨»å†Šé–‹ç™¼è€…ï¼Œç™»å…¥å¾Œé ˆå»ºç«‹ä¸€å€‹ Providerï¼Œåƒæ˜¯ APP é–‹ç™¼åœ˜éšŠæˆ–å…¬å¸åç¨±ï¼Œè·Ÿå€‹äººè³‡è¨Šç„¡é—œçš„ã€‚</li>\n<li>ç„¶å¾Œåœ¨ä½ å»ºç«‹çš„ Provider ä¸­ï¼Œæ–°å¢ä¸€å€‹é »é“(channel)ï¼Œæœƒå‡ºç¾ä¸€å€‹åƒåŠŸèƒ½åˆ—çš„é¸å–®ï¼Œå°±æ˜¯é€™æ”¯é »é“æ˜¯ç”¨ä¾†åšä»€éº¼çš„ï¼Œå› ç‚ºæˆ‘å€‘æ˜¯è¦ç”¨ç¬¬ä¸‰æ–¹ç™»å…¥å°±é¸ <strong>LINE Login</strong></li>\n</ol>\n<p><img src=\"https://i.imgur.com/QUfLcZo.png\"></p>\n<ol start=\"5\">\n<li>åŸºæœ¬è¦å¡«çš„å°±æ˜¯ Channel nameã€Channel descriptionã€Emailã€€ä¸‰é …ï¼Œç„¶å¾Œå»è¨­å®š(LINE Login)é¸æ“‡ <strong>Mobile APP</strong>ï¼Œå¡«å…¥åŒ…è£¹åç¨±</li>\n</ol>\n<p><img src=\"https://i.imgur.com/9SwgPdL.png\"></p>\n<p>ä¹Ÿå°±æ˜¯ <code>build.gradle</code> è£¡é¢çš„ã€€<strong>applicationId</strong></p>\n<p><img src=\"https://i.imgur.com/fhavrwO.png\"></p>\n<p>å¦‚æœé‚„ä¸å¤ªç†è§£ï¼Œå¯ä»¥åœ¨ <a href=\"https://developers.line.biz/en/docs/messaging-api/getting-started/#creating-a-channel\">Getting started with the Messaging API</a> æŸ¥çœ‹æ­¥é©Ÿï¼Œå¡«å®Œé€™äº›ä½ å°±å¯ä»¥å¾—åˆ° Channel ID å’Œ Channel secret ç­‰è³‡æ–™ï¼Œç­‰ä¸‹å‰è€…æ˜¯è¦ç”¨ä¾†è¨­ç½®åƒæ•¸çš„ã€‚</p>\n<hr>\n<p>å‰ç½®ä½œæ¥­å®Œæˆäº†ï¼Œä¾†å¯¦ä½œç¨‹å¼ç¢¼çš„éƒ¨åˆ†ï¼Œåœ¨ XML ä¸Šæ–°å¢ä¸€å€‹æŒ‰éˆ•ï¼Œå› ç‚º LINE æœ‰æä¾›å…§å»ºçš„ç™»å…¥æŒ‰éˆ•ï¼Œé€™è£¡å°±ç›´æ¥ä½¿ç”¨ï¼š</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;</span><span class=\"mtk12\">com</span><span class=\"mtk1\">.</span><span class=\"mtk12\">linecorp</span><span class=\"mtk1\">.</span><span class=\"mtk12\">linesdk</span><span class=\"mtk1\">.</span><span class=\"mtk12\">widget</span><span class=\"mtk1\">.</span><span class=\"mtk12\">LoginButton</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    android</span><span class=\"mtk15\">:</span><span class=\"mtk1\">id=</span><span class=\"mtk8\">&quot;@+id/line_login_btn&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    android</span><span class=\"mtk15\">:</span><span class=\"mtk1\">layout_width=</span><span class=\"mtk8\">&quot;match_parent&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    android</span><span class=\"mtk15\">:</span><span class=\"mtk1\">layout_height=</span><span class=\"mtk8\">&quot;wrap_content&quot;</span><span class=\"mtk1\"> /&gt;</span></span></span></code></pre>\n<p>å¤§æ¦‚é•·é€™å€‹æ¨£å­\n<img src=\"https://i.imgur.com/ozwNiHX.png\"></p>\n<p>Activity çš„éƒ¨åˆ†ï¼Œç‚º LINE ç™»å…¥æŒ‰éˆ•è¨­ç½®å¿…è¦çš„åƒæ•¸ã€ç›£è½å™¨ï¼Œæ¯”è¼ƒæ³¨æ„çš„æ˜¯</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//LINEç™»å…¥æŒ‰éˆ•è¨­å®š</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">lateinit </span><span class=\"mtk4\">var</span><span class=\"mtk1\"> </span><span class=\"mtk12\">params</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk10\">LineAuthenticationParams</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">private</span><span class=\"mtk1\"> fun </span><span class=\"mtk11\">setLineLogin</span><span class=\"mtk1\">(){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val loginDelegate = </span><span class=\"mtk12\">LoginDelegate</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Factory</span><span class=\"mtk1\">.</span><span class=\"mtk11\">create</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//æ”¾å…¥ChannelId å­—ä¸²</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">btn_line_login</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setChannelId</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;1653832701&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//æ˜¯å¦åªé€éLINE APPï¼Œæˆ–å¯ä»¥é€éç¶²é </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">btn_line_login</span><span class=\"mtk1\">.</span><span class=\"mtk11\">enableLineAppAuthentication</span><span class=\"mtk1\">(</span><span class=\"mtk4\">true</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//params å¯«ç™»å…¥å¾Œè«‹æ±‚çš„æ¬Šé™ç¯„åœ</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    params = </span><span class=\"mtk12\">LineAuthenticationParams</span><span class=\"mtk1\">.</span><span class=\"mtk11\">Builder</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">scopes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Arrays</span><span class=\"mtk1\">.</span><span class=\"mtk11\">asList</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Scope</span><span class=\"mtk1\">.</span><span class=\"mtk12\">PROFILE</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">build</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//LoginæŒ‰éˆ•åƒæ•¸å’Œç›£è½å™¨</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">btn_line_login</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setAuthenticationParams</span><span class=\"mtk1\">(params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">btn_line_login</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setLoginDelegate</span><span class=\"mtk1\">(loginDelegate)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">btn_line_login</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addLoginListener</span><span class=\"mtk1\">(object</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> LoginListener{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        override fun </span><span class=\"mtk11\">onLoginSuccess</span><span class=\"mtk1\">(result</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> LineLoginResult) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">Toast</span><span class=\"mtk1\">.</span><span class=\"mtk11\">makeText</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">@</span><span class=\"mtk10\">MainActivity</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Login success&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">Toast</span><span class=\"mtk1\">.</span><span class=\"mtk12\">LENGTH_SHORT</span><span class=\"mtk1\">).</span><span class=\"mtk11\">show</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        override fun </span><span class=\"mtk11\">onLoginFailure</span><span class=\"mtk1\">(result</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> LineLoginResult</span><span class=\"mtk15\">?</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">Toast</span><span class=\"mtk1\">.</span><span class=\"mtk11\">makeText</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">@</span><span class=\"mtk10\">MainActivity</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Login failure&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">Toast</span><span class=\"mtk1\">.</span><span class=\"mtk12\">LENGTH_SHORT</span><span class=\"mtk1\">).</span><span class=\"mtk11\">show</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><strong>ğŸ””é–‹å§‹ LINE ç™»éŒ„</strong>\né€™è£¡å¯ä»¥æœ‰å…©ç¨®å¯«æ³•ï¼Œé¸æ“‡å°å…¥ LINE APP æˆ–æ˜¯ç›´æ¥é–‹å•Ÿ WebViewï¼Œä¹‹å¾Œæœ‰ç©ºè£œä¸Šé‚è¼¯ï¼Œè‡ªå‹•åˆ¤æ–·ä½¿ç”¨è€…æ˜¯å¦æœ‰è£ä¸ŠæŸæ‡‰ç”¨ç¨‹å¼</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//ä½¿ç”¨æ‡‰ç”¨ç¨‹åºç™»å…¥ #1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">btn_line_login</span><span class=\"mtk1\">.</span><span class=\"mtk12\">setOnClickListener</span><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val loginIntent = </span><span class=\"mtk12\">LineLoginApi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getLoginIntent</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;1653832701&quot;</span><span class=\"mtk1\">, params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">startActivityForResult</span><span class=\"mtk1\">(loginIntent, REQ_LINE_CODE)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//ç€è¦½å™¨çš„LINEç™»å…¥ #2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">btn_line_login</span><span class=\"mtk1\">.</span><span class=\"mtk12\">setOnClickListener</span><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val loginIntent = </span><span class=\"mtk12\">LineLoginApi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getLoginIntentWithoutLineAppAuth</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;1653832701&quot;</span><span class=\"mtk1\">, params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">startActivityForResult</span><span class=\"mtk1\">(loginIntent, REQ_LINE_CODE)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>æ¥æ”¶ LINE ç™»å…¥å›å‚³çµæœï¼Œä»¥ <code>onActivityResult()</code> æ–¹æ³•è¿”å›ï¼Œå¯å–å¾—ç”¨æˆ¶è³‡è¨Šå’Œ <strong>Token</strong></p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">override fun </span><span class=\"mtk11\">onActivityResult</span><span class=\"mtk1\">(requestCode</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Int, resultCode</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Int, data</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Intent</span><span class=\"mtk15\">?</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">super</span><span class=\"mtk1\">.</span><span class=\"mtk11\">onActivityResult</span><span class=\"mtk1\">(requestCode, resultCode, data)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (requestCode == REQ_LINE_CODE &amp;&amp; data != </span><span class=\"mtk4\">null</span><span class=\"mtk1\">){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val result = </span><span class=\"mtk12\">LineLoginApi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getLoginResultFromIntent</span><span class=\"mtk1\">(data)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">when</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">result</span><span class=\"mtk1\">.</span><span class=\"mtk12\">responseCode</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//å›æ‡‰æˆåŠŸ</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">LineApiResponseCode</span><span class=\"mtk1\">.</span><span class=\"mtk12\">SUCCESS</span><span class=\"mtk1\"> </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            val userId = </span><span class=\"mtk12\">result</span><span class=\"mtk1\">.</span><span class=\"mtk12\">lineProfile</span><span class=\"mtk1\">!!.</span><span class=\"mtk12\">userId</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            val displayName = </span><span class=\"mtk12\">result</span><span class=\"mtk1\">.</span><span class=\"mtk12\">lineProfile</span><span class=\"mtk1\">!!.</span><span class=\"mtk12\">displayName</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            val accessToken = </span><span class=\"mtk12\">result</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getLineCredential</span><span class=\"mtk1\">()!!.</span><span class=\"mtk11\">getAccessToken</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getTokenString</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//å›æ‡‰å¤±æ•—</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">LineApiResponseCode</span><span class=\"mtk1\">.</span><span class=\"mtk12\">CANCEL</span><span class=\"mtk1\"> </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">Log</span><span class=\"mtk1\">.</span><span class=\"mtk11\">e</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;ljwx-line-cancel-&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;cancel&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li><a href=\"/kotlin/%E5%AF%A6%E4%BD%9C%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5/#facebook%E7%B0%A1%E6%98%93%E7%99%BB%E5%85%A5%E5%81%9A%E6%B3%95\">Facebookç°¡æ˜“ç™»å…¥åšæ³•</a></li>\n<li>\n<p><a href=\"/kotlin/%E5%AF%A6%E4%BD%9C%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5/#google%E7%99%BB%E5%85%A5\">Googleç™»å…¥</a></p>\n<ul>\n<li><a href=\"/kotlin/%E5%AF%A6%E4%BD%9C%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5/#%E5%A6%82%E4%BD%95%E5%8F%96%E5%BE%97-sha-1-%E5%80%BC\">å¦‚ä½•å–å¾— SHA-1 å€¼</a></li>\n<li><a href=\"/kotlin/%E5%AF%A6%E4%BD%9C%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5/#google%E7%99%BB%E5%85%A5%E5%95%8F%E9%A1%8C\">Googleç™»å…¥å•é¡Œ</a></li>\n</ul>\n</li>\n<li><a href=\"/kotlin/%E5%AF%A6%E4%BD%9C%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5/#line%E7%99%BB%E5%85%A5\">LINEç™»å…¥</a></li>\n</ul>","frontmatter":{"title":"Android - å¯¦ä½œç¬¬ä¸‰æ–¹ç™»å…¥","date":"Feb 11, 2020","tags":["Kotlin"],"category":"Android","thumbnail":null}}},"pageContext":{"slug":"/kotlin/å¯¦ä½œç¬¬ä¸‰æ–¹ç™»å…¥/","previous":{"fields":{"slug":"/kotlin/é–‹å•Ÿç›¸æ©Ÿæ¬Šé™/"},"frontmatter":{"title":"Android - æƒæ QR Code","tags":["Kotlin"],"date":"2019-11-26","category":"Android","mark":null,"description":"é–‹å•Ÿç›¸æ©Ÿæ¬Šé™åŠæƒç„åŠŸèƒ½"}},"next":{"fields":{"slug":"/note/æƒ³çŸ¥é“å—ï½œOfaï¼šæˆç‚ºä¸€ä½æ•¸ä½éŠç‰§æ°‘æ—/"},"frontmatter":{"title":"æƒ³çŸ¥é“å—ï½œOfaï¼šæˆç‚ºä¸€ä½æ•¸ä½éŠç‰§æ°‘æ—","tags":["å¥½æƒ³å·¥ä½œå®¤","æƒ³çŸ¥é“å—"],"date":"2020-02-15","category":null,"mark":null,"description":null}}}},"staticQueryHashes":["63159454"]}