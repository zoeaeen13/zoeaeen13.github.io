{"componentChunkName":"component---src-templates-blog-post-js","path":"/kotlin/å¦‚ä½•æ¥API/","result":{"data":{"site":{"siteMetadata":{"title":"Travel in Time.","author":"Zoe Yu"}},"markdownRemark":{"id":"696eadec-1e07-5b33-bc15-84dbb555de16","excerpt":"è¿‘æœŸæŒ‘æˆ°è³½éœ€è¦æ¥ Apiï¼Œä¾†ç·´ç¿’ Retrofit ä½¿ç”¨ Retrofit ç”± Retrofit 2 å°è£ï¼Œå¾ŒçºŒäº¤ç”± OkHttp é€²è¡Œè«‹æ±‚æ“ä½œï¼Œæ“ä½œæ””æˆªçš„è©±å¦‚ Time out é‚„æ˜¯åœ¨ OkHttpClient è¨­å®š Retrofit 2 å‰‡æ˜¯éµå¾ª RESTful çš„ Httpâ€¦","html":"<p>è¿‘æœŸæŒ‘æˆ°è³½éœ€è¦æ¥ Apiï¼Œä¾†ç·´ç¿’ Retrofit</p>\n<h2>ä½¿ç”¨ Retrofit</h2>\n<p>ç”± Retrofit 2 å°è£ï¼Œå¾ŒçºŒäº¤ç”± OkHttp é€²è¡Œè«‹æ±‚æ“ä½œï¼Œæ“ä½œæ””æˆªçš„è©±å¦‚ Time out é‚„æ˜¯åœ¨ OkHttpClient è¨­å®š</p>\n<ul>\n<li>Retrofit 2 å‰‡æ˜¯éµå¾ª RESTful çš„ Http æ¡†æ¶é€²è¡Œå°è£</li>\n<li>ç¶²è·¯è«‹æ±‚çš„å‹•ä½œä¸»è¦ç”± OkHttp é€²è¡Œ</li>\n</ul>\n<p>å…ˆçœ‹éé€™äº›è³‡æ–™å†å»å˜—è©¦ï¼šæœ‰å“ªäº›æ¥ api çš„æ–‡ç« å¯ä»¥åƒè€ƒ</p>\n<ol>\n<li><a href=\"https://medium.com/%E5%B7%A5%E7%A8%8B%E5%B8%AB%E6%B1%82%E7%94%9F%E6%8C%87%E5%8D%97-sofware-engineer-survival-guide/retrofit-2-%E8%B5%B7%E6%89%8B%E5%BC%8F-212644f33a9a\">Retrofit 2 èµ·æ‰‹å¼</a></li>\n<li><a href=\"https://blog.csdn.net/carson_ho/article/details/73732076\">é€™æ˜¯ä¸€ä»½å¾ˆè©³ç´°çš„ Retrofit 2.0 ä½¿ç”¨æ•™ç¨‹</a></li>\n<li><a href=\"https://medium.com/@givemepass/retrofit-%E6%93%8D%E4%BD%9C%E6%95%99%E5%AD%B8-26c7851ec154\">Retrofit æ“ä½œæ•™å­¸</a></li>\n<li><a href=\"https://www.jianshu.com/p/8203238b4a1d\">Retrofit ç¶²è·¯è«‹æ±‚å­¸ç¿’ç­†è¨˜</a></li>\n</ol>\n<hr>\n<h3>åŠ å…¥ç¬¬ä¸‰æ–¹è³‡æº</h3>\n<p><a href=\"https://square.github.io/okhttp/\">OkHttp 3</a>ã€<a href=\"https://square.github.io/retrofit/\">Retrofit2</a> æœ€æ–°ç‰ˆæœ¬åƒè€ƒ</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">implementation </span><span class=\"mtk8\">&#39;com.squareup.retrofit2:retrofit:2.6.0&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">implementation </span><span class=\"mtk8\">&#39;com.squareup.retrofit2:converter-gson:2.6.0&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">implementation </span><span class=\"mtk8\">&#39;com.squareup.okhttp3:okhttp:4.2.1&#39;</span></span></span></code></pre>\n<p>è£æ””æˆªå™¨ï¼Œdebug æ™‚å¾ˆæ–¹ä¾¿</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">implementation </span><span class=\"mtk8\">&quot;com.squareup.okhttp3:logging-interceptor:4.0.1&quot;</span></span></span></code></pre>\n<h3>é–‹å•Ÿç¶²è·¯æ¬Šé™</h3>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;uses-permission android</span><span class=\"mtk15\">:</span><span class=\"mtk1\">name=â€</span><span class=\"mtk12\">android</span><span class=\"mtk1\">.</span><span class=\"mtk12\">permission</span><span class=\"mtk1\">.</span><span class=\"mtk12\">INTERNET</span><span class=\"mtk1\">â€ /&gt;</span></span></span></code></pre>\n<hr>\n<h2>1. å‰µå»º Retrofit å–®ä¾‹ç‰©ä»¶</h2>\n<h3>å°‡å‘¼å« Api å¯«æˆä¸€å€‹å…¨åŸŸå¯¦ä¾‹</h3>\n<blockquote>\n<p>ä¸€å€‹é¡åªæœ‰ä¸€å€‹å¯¦ä¾‹ï¼Œä¸¦ä¸”è©²é¡æä¾›äº†å…¨åŸŸè¨ªå•</p>\n</blockquote>\n<p>åƒè€ƒ <a href=\"https://code.tutsplus.com/zh-hant/tutorials/android-design-patterns-the-singleton-pattern--cms-29153\">Android è¨­è¨ˆæ¨¡å¼ï¼šå–®ä¾‹æ¨¡å¼</a>ï¼Œäº†è§£å¾ˆå¤šæ™‚å€™æˆ‘å€‘éƒ½åªéœ€è¦ç‰©ä»¶çš„ä¸€å€‹å¯¦ä¾‹ï¼Œåƒæ˜¯å¿«å–è¨˜æ†¶é«”ã€OkHttpClientã€HttpLoggingInterceptorã€Retrofitã€Gsonã€SharedPreferences å’Œå€‰åº«é¡ç­‰ã€‚å¦‚æœé€™äº›é¡ç”¢ç”Ÿå¤šå€‹ç‰©ä»¶å¯¦ä¾‹ï¼Œå°±æœƒé‡åˆ°è¨±å¤šå•é¡Œï¼Œæ¯”å¦‚ç•°å¸¸çš„ APP åæ‡‰ï¼Œè³‡æºéåº¦ä½¿ç”¨å’Œå…¶ä»–æ··äº‚çµæœã€‚</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">object API {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//by lazy åœ¨éœ€è¦ç”¨åˆ°æ™‚æ‰å»ºç«‹ï¼Œåªæœƒåˆå§‹åŒ–ä¸€æ¬¡</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val apiInterface</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Api_Interface</span><span class=\"mtk1\"> by lazy {  </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//æ””æˆªå™¨ï¼Œç”¨ä»¥debug (éå¿…è¦)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val logging = </span><span class=\"mtk11\">HttpLoggingInterceptor</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">logging</span><span class=\"mtk1\">.</span><span class=\"mtk12\">level</span><span class=\"mtk1\"> = (</span><span class=\"mtk12\">HttpLoggingInterceptor</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Level</span><span class=\"mtk1\">.</span><span class=\"mtk12\">BODY</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//å»ºç«‹OkHttpClient</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val myOkHttpClient = </span><span class=\"mtk12\">OkHttpClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">Builder</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">readTimeout</span><span class=\"mtk1\">(</span><span class=\"mtk7\">10</span><span class=\"mtk1\">, </span><span class=\"mtk12\">TimeUnit</span><span class=\"mtk1\">.</span><span class=\"mtk12\">SECONDS</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">addInterceptor</span><span class=\"mtk1\">(logging)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">build</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//retrofitå¯¦é«”</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\">@</span><span class=\"mtk10\">lazy</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Retrofit</span><span class=\"mtk1\">.</span><span class=\"mtk11\">Builder</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">baseUrl</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;http://104.155.209.122&quot;</span><span class=\"mtk1\">)  </span><span class=\"mtk3\">//ç¶²å€</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">client</span><span class=\"mtk1\">(myOkHttpClient)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">addConverterFactory</span><span class=\"mtk1\">(</span><span class=\"mtk12\">GsonConverterFactory</span><span class=\"mtk1\">.</span><span class=\"mtk11\">create</span><span class=\"mtk1\">())  </span><span class=\"mtk3\">//è§£æJson</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">build</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk11\">create</span><span class=\"mtk1\">(Api_Interface</span><span class=\"mtk15\">::</span><span class=\"mtk12\">class</span><span class=\"mtk1\">.</span><span class=\"mtk12\">java</span><span class=\"mtk1\">)   </span><span class=\"mtk3\">//httpçš„è«‹æ±‚æ¥å£</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3>addInterceptor æ””æˆªå™¨</h3>\n<ul>\n<li>å°æ±è¥¿ <a href=\"https://github.com/square/okhttp/tree/master/okhttp-logging-interceptor\">Logging Interceptor</a>\nå¯ä»¥åšä»€éº¼ï¼Ÿ\nå¡æ±è¥¿é€²å»æ¯ä¸€å€‹ç¶²è·¯è«‹æ±‚ï¼Œå¯ä»¥å°å‡ºå…§å®¹å¦‚ä¸‹ï¼Œå°å‡ºé¡å‹é¸æ“‡ï¼šNONEã€BASICã€HEADERSã€BODY ç­‰ç­‰ï¼Œä»£è¡¨å…§å®¹çš„è©³ç›¡ç¨‹åº¦\n<img src=\"https://i.imgur.com/6InYSXl.png\"></li>\n<li>å¤¾å¸¶ <code>@Header</code>\nä¹Ÿå¯ä»¥å¡å…¥ Header é¡å‹ï¼Œé€™æ¨£æ¯ä¸€å€‹ç¶²è·¯è«‹æ±‚å°±æœƒå¸¶è‘—ï¼Œæ¯”å¦‚ Content-Typeã€Accept ç”šè‡³æ˜¯ Authorization\n<img src=\"https://i.imgur.com/yOj1CAd.png\"></li>\n</ul>\n<p>é‚£éº¼åœ¨è«‹æ±‚æ¥å£ï¼Œå°±ä¸éœ€è¦æ¯ä¸€å€‹éƒ½åŠ ä¸Š @Header</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">GET</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/api/tags&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//è¨»è§£ fun showMagic(@Header(&quot;Authorization&quot;) token: String): Call&lt;MagicList&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    fun </span><span class=\"mtk11\">showMagic</span><span class=\"mtk1\">()</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Call</span><span class=\"mtk1\">&lt;MagicList&gt;</span></span></span></code></pre>\n<hr>\n<h3>è«‹æ±‚æ¥å£ Api Interface</h3>\n<p>å‰µç«‹ Http çš„è«‹æ±‚æ¥å£ï¼Œä¾‹å¦‚ <code>@GET</code> å’Œ <code>@POST</code> ç”¨æ³•ï¼Œäº†è§£ <code>@Body</code> å’Œ <code>@Query</code> åƒæ•¸ä½œç”¨ã€‚</p>\n<p>è©²æ€éº¼ç†è§£ Interfaceï¼Ÿ\nå¯ä»¥æƒ³åƒæˆä¸€èˆ¬è³‡æ–™æ˜¯ç”±å¾Œç«¯æä¾›ï¼Œé‚£å‰ç«¯å°±è¦å»æ¥é€™å€‹è³‡æ–™ï¼Œåœ¨ Interface é€™å€‹ä¸­ä»‹ç«™è£¡é¢å®Œæˆæºé€šï¼Œæ‰€ä»¥éœ€è¦å¡«å…¥è«‹æ±‚çš„é¡å‹ã€è«‹æ±‚çš„åƒæ•¸ã€è¦æ±‚è¿”å›çš„è³‡æ–™ç­‰ç­‰ã€‚</p>\n<p>å¯ä»¥çœ‹åˆ°ä¸‹æ–¹å¯«äº†ä¸‰å€‹å‡½å¼ï¼Œä¸åŒçš„ url å°æ‡‰ä¸åŒçš„ç¶²è·¯è«‹æ±‚ï¼Œæœ‰äº›éœ€è¦å¸¶ç‰¹å®šåƒæ•¸ï¼ˆä¾‹å¦‚æŸå€‹ Int å€¼æˆ– <xxRequest>ï¼‰æœ‰äº›å‰‡ä¸ç”¨ï¼Œè¦æ±‚çš„å›å‚³è³‡æ–™å‰‡ç”¨<xxResponse>å»æ¥ï¼Œé€™å€‹æ˜¯æˆ‘å€‘è‡ªå®šç¾©çš„ Data classï¼Œä¸‹ä¸€æ­¥æœƒé€²è¡Œèªªæ˜ï¼š</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">interface</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Api_Interface</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk10\">GET</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/api/playerGameStatus&quot;</span><span class=\"mtk1\">)   </span><span class=\"mtk3\">//url</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    fun </span><span class=\"mtk11\">gameStatus</span><span class=\"mtk1\">(): Call&lt;</span><span class=\"mtk10\">PlayerResponse</span><span class=\"mtk1\">&gt;  </span><span class=\"mtk3\">//è¦æ±‚å›å‚³è³‡æ–™æ ¼å¼&lt;PlayerResponse &gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk11\">POST</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/api/enterGame&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    fun </span><span class=\"mtk11\">enterGame</span><span class=\"mtk1\">(@</span><span class=\"mtk10\">Body</span><span class=\"mtk1\"> </span><span class=\"mtk12\">enterRequest</span><span class=\"mtk1\">: </span><span class=\"mtk12\">EnterRequest</span><span class=\"mtk1\">): Call&lt;</span><span class=\"mtk10\">EnterResponse</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @</span><span class=\"mtk11\">GET</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;/api/playerGameAnswer&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    fun </span><span class=\"mtk11\">bomb</span><span class=\"mtk1\">(@</span><span class=\"mtk10\">Query</span><span class=\"mtk1\">( </span><span class=\"mtk8\">&quot;playerId&quot;</span><span class=\"mtk1\"> ) </span><span class=\"mtk12\">playerId</span><span class=\"mtk1\">:</span><span class=\"mtk12\">Int</span><span class=\"mtk1\">): Call&lt;</span><span class=\"mtk10\">BombResponse</span><span class=\"mtk1\">&gt;</span></span></span></code></pre>\n<hr>\n<h2>2. å®šç¾©è³‡æ–™æ ¼å¼</h2>\n<p>å’Œå¾Œç«¯æºé€šæ‰€éœ€çš„è³‡æ–™å‹æ…‹ï¼Œä»¥ä¾¿æ–¼å°æ¥ã€‚å¦‚æœè¦æ¥çš„è³‡æ–™é•·é€™å€‹æ¨£å­ï¼Œå¯èƒ½é‚„æ¯”è¼ƒå¥½æ‹†è§£ï¼š\n<img src=\"https://i.imgur.com/0Q8Hnll.png\"></p>\n<p>ä½†å¦‚æœä»Šå¤©çœ‹åˆ°è¦æ¥çš„ API é•·é€™æ¨£ï¼Œå¯èƒ½æœ‰äº›é›£ä»¥é€²è¡Œï¼š</p>\n<p><img src=\"https://i.imgur.com/h3xiidC.png\"></p>\n<p>é€™æ™‚æˆ‘å€‘å¯åˆ©ç”¨ä¸€äº›å°å·¥å…·ä¾†å®Œæˆè³‡æ–™æ ¼å¼ï¼š</p>\n<ul>\n<li>é–‹ Postman æŸ¥çœ‹</li>\n<li>ç·šä¸Šç‰ˆ <a href=\"https://jsoneditoronline.org/\">JsonEditorOnline</a>\n<img src=\"https://i.imgur.com/hzZv6YZ.png\"></li>\n<li>å®‰è£ <a href=\"https://plugins.jetbrains.com/plugin/9960-json-to-kotlin-class-jsontokotlinclass-\">JSON To Kotlin Class</a> å¥—ä»¶\nåœ¨ Android Studio é»é¸å·¦ä¸Šè§’ code>> generate>> Kotlin Data Classes from JSONï¼ˆæˆ–ç›´æ¥éµç›¤ alt+Kï¼‰ç›´æ¥ç”Ÿæˆæ ¼å¼\n<img src=\"https://i.imgur.com/5MvgY9L.png\"></li>\n</ul>\n<hr>\n<p>æŠŠè«‹æ±‚åƒæ•¸ <strong>Request</strong> å’Œå›å‚³è³‡æ–™ <strong>Response</strong> çš„æ ¼å¼å¯«å¥½ï¼Œå°±æ˜¯ç”¨ä¾†å¡«å…¥è«‹æ±‚ Call çš„è³‡æ–™æ ¼å¼</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">data </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">EnterRequest</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val enterTime: Int,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val name: String,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val position: Int</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">data </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">EnterResponse</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val endTime: String,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val playerId: Int,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val players: List&lt;</span><span class=\"mtk10\">PlayInfo</span><span class=\"mtk1\">&gt;,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val yourName: String</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span></code></pre>\n<hr>\n<h2>3. åœ¨ Activtiy.kt å¯¦ä½œæ¥å¾Œç«¯è³‡æ–™ï¼ˆç•°æ­¥è«‹æ±‚ï¼‰</h2>\n<p>åŸ·è¡Œ Call function çš„ <strong>enqueue</strong> æ–¹æ³•ï¼Œéœ€å¸¶å…¥ Callback è™•ç†å›å‚³çµæœï¼Œå¾å›å‚³çµæœï¼ˆonResponseï¼‰è£¡é¢å¯æ‹¿åˆ° Service å›å‚³çš„è³‡æ–™</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">enqueue</span><span class=\"mtk1\">(callback</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Callback)</span></span></span></code></pre>\n<p>è¦æ³¨æ„ï¼Œç”¨é€™æ–¹æ³• OkHttp æ˜¯è‡ªè¡Œç”¢ç”Ÿä¸€å€‹åŸ·è¡Œç·’ï¼Œåœ¨è£¡é¢åŸ·è¡Œ Call çš„ execute æ–¹æ³•ï¼ˆåƒè€ƒ<a href=\"https://ithelp.ithome.com.tw/articles/10207954\">é€™ç¯‡</a>ï¼‰</p>\n<blockquote>\n<p>ä¸éœ€è¦è‡ªå·±å¦é–‹ Thread ä¾†åŸ·è¡Œè«‹æ±‚ï¼ŒCallback ä¹Ÿæœƒåœ¨è©² Thread ä¸­åŸ·è¡Œã€‚\nä½†è‹¥éœ€è®Šæ›´ UI ä»‹é¢å°±éœ€è¦ç”¨ runOnUiThread æ–¹æ³•ç”±ä¸»åŸ·è¡Œç·’è™•ç†ã€‚</p>\n</blockquote>\n<hr>\n<p>é€šå¸¸æˆ‘å€‘éœ€è¦çš„è³‡è¨Šæœƒåœ¨ Response çš„ body() å–”ï¼</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">API1</span><span class=\"mtk1\">.</span><span class=\"mtk12\">apiInterface</span><span class=\"mtk1\">.</span><span class=\"mtk11\">gameStatus</span><span class=\"mtk1\">().</span><span class=\"mtk11\">enqueue</span><span class=\"mtk1\">(object</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Callback</span><span class=\"mtk1\">&lt;PlayerResponse&gt;{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    override fun </span><span class=\"mtk11\">onFailure</span><span class=\"mtk1\">(call</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Call</span><span class=\"mtk1\">&lt;PlayerResponse&gt;, t</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> Throwable) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;=============$t&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    override fun </span><span class=\"mtk11\">onResponse</span><span class=\"mtk1\">(call</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Call</span><span class=\"mtk1\">&lt;PlayerResponse&gt;, response</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Response</span><span class=\"mtk1\">&lt;PlayerResponse&gt;) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">response</span><span class=\"mtk1\">.</span><span class=\"mtk11\">code</span><span class=\"mtk1\">() == </span><span class=\"mtk7\">200</span><span class=\"mtk1\">){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            val responsebody = </span><span class=\"mtk12\">response</span><span class=\"mtk1\">.</span><span class=\"mtk11\">body</span><span class=\"mtk1\">()   </span><span class=\"mtk3\">//è³‡æ–™å°±åœ¨æ”¾åœ¨body()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;=============$responsebody&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">})</span></span></span></code></pre>\n<hr>\n<h3>ğŸ”¨ä½¿ç”¨ http æœƒè¢« Android Studio æ“‹ä¸‹çš„å•é¡Œ</h3>\n<p>å¦‚æœç™¼é€è«‹æ±‚ä¸€ç›´ä¸éï¼Œé™¤äº†æ²’é–‹ç¶²è·¯æ¬Šé™ï¼Œé‚„è¦æŸ¥çœ‹æ˜¯ä¸æ˜¯å°å‡ºä»¥ä¸‹å…§å®¹ï¼Œå¯èƒ½å› å®‰å…¨æ€§å•é¡Œè¢«æ“‹ä¸‹</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">UnknownServiceException</span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">CLEARTEXT</span><span class=\"mtk1\"> communication to </span><span class=\"mtk12\">f5234a33</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ngrok</span><span class=\"mtk1\">.</span><span class=\"mtk12\">io</span><span class=\"mtk1\"> not permitted by network security policy</span></span></span></code></pre>\n<p>ç¬¬ä¸€ç¨®æ–¹æ³•å°±æ˜¯å…ˆé–‹ Postman æŸ¥çœ‹èƒ½ä¸èƒ½è‡ªè¡ŒåŠ  s ä¾†è§£æ±ºé€™å€‹å•é¡Œ\næœ‰äº›è‡ªè¡Œæ›´æˆ https å¯ä»¥éé—œï¼Œæœ‰äº›å»ä¸è¡Œ</p>\n<p>é‚£éº¼ï¼Œåœ¨ä¸éº»ç…©å¾Œç«¯çš„æƒ…æ³ä¸‹ï¼Œå¯ä»¥é€éä¸€äº›è¨­å®šä¾†ä¿®æ”¹Android Studio é è¨­ï¼Œåƒè€ƒé€™ç¯‡ <a href=\"https://www.jianshu.com/p/57047a84e559\">http ç½‘ç»œè¯·æ±‚çš„é—®é¢˜</a>ä¾†è§£æ±º</p>\n<ol>\n<li>åœ¨ res ä¸‹æ–°å¢ä¸€å€‹åç‚º xml è³‡æ–™å¤¾ï¼Œç„¶åå»ºç«‹ä¸€ä¸ª.xml æ–‡ä»¶ï¼Œå–å network<em>security</em>config</li>\n</ol>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;</span><span class=\"mtk15\">?</span><span class=\"mtk1\">xml version=</span><span class=\"mtk8\">&quot;1.0&quot;</span><span class=\"mtk1\"> encoding=</span><span class=\"mtk8\">&quot;utf-8&quot;</span><span class=\"mtk15\">?</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;network-security-config&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;base-config cleartextTrafficPermitted=</span><span class=\"mtk8\">&quot;true&quot;</span><span class=\"mtk1\"> /&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;/network-security-config&gt;</span></span></span></code></pre>\n<p><img src=\"https://i.imgur.com/hOnRc6k.png\"></p>\n<ol start=\"2\">\n<li>åœ¨Manifest çš„ <strong>application æ¨™ç±¤</strong>å¢åŠ å±æ€§ <code>networkSecurityConfig</code></li>\n</ol>\n<p><img src=\"https://i.imgur.com/i2IyuXI.png\"></p>\n<hr>\n<hr>\n<h3>Tips</h3>\n<ul>\n<li>æœ€å¥½åœ¨ onFailure å’Œ onResponse å°å‡ºä¾†å…§å®¹ï¼Œå¦‚æœå‡ºéŒ¯å¯ä»¥çœ‹åˆ°æ˜¯ä»€éº¼åŸå› </li>\n<li>è¨­æ¢ä»¶ <code>response.isSuccessful</code> æˆ–åˆ¤æ–·ç‹€æ…‹ç¢¼ <code>response.code() == 200</code>ï¼Œé€šå¸¸ onResponse æœ‰å¥½å¹¾ç¨®å›å‚³çµæœ</li>\n<li>onResponse å…¶å¯¦æœƒè™•ç† 200~500 çš„ <strong>ErrorResponse</strong></li>\n<li>æ¥åˆ° <code>response.body()</code> ä¹‹å¾Œï¼Œå†ç¯€é¸åšæˆè‡ªå·±éœ€è¦çš„è³‡æ–™å°±è¡Œ</li>\n<li>ç™¼ç”ŸéŒ¯èª¤ç­‰é 200 çš„ç‹€æ…‹ï¼Œæ˜¯ç„¡æ³•å¾ <code>response.body()</code> å–å¾—è³‡æ–™ï¼Œè¦å¾`response.errorBody() æ‹¿</li>\n<li>éç¶²è·¯å›å‚³çš„ç‹€æ…‹è™•ç†ï¼Œé€é onFailure çš„ callbackï¼Œåƒè€ƒ<a href=\"https://medium.com/@jefflin1982/android-%E9%97%9C%E6%96%BCretrofil%E7%9A%84%E5%85%B6%E4%BB%96%E5%B0%8F%E4%BA%8B%E6%83%85-587609eb27e5\">é—œæ–¼Retrofitçš„å…¶ä»–å°äº‹æƒ…</a></li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk7 { color: #B5CEA8; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/kotlin/%E5%A6%82%E4%BD%95%E6%8E%A5API/#%E4%BD%BF%E7%94%A8-retrofit\">ä½¿ç”¨ Retrofit</a></p>\n<ul>\n<li><a href=\"/kotlin/%E5%A6%82%E4%BD%95%E6%8E%A5API/#%E5%8A%A0%E5%85%A5%E7%AC%AC%E4%B8%89%E6%96%B9%E8%B3%87%E6%BA%90\">åŠ å…¥ç¬¬ä¸‰æ–¹è³‡æº</a></li>\n<li><a href=\"/kotlin/%E5%A6%82%E4%BD%95%E6%8E%A5API/#%E9%96%8B%E5%95%9F%E7%B6%B2%E8%B7%AF%E6%AC%8A%E9%99%90\">é–‹å•Ÿç¶²è·¯æ¬Šé™</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/kotlin/%E5%A6%82%E4%BD%95%E6%8E%A5API/#1-%E5%89%B5%E5%BB%BA-retrofit-%E5%96%AE%E4%BE%8B%E7%89%A9%E4%BB%B6\">1. å‰µå»º Retrofit å–®ä¾‹ç‰©ä»¶</a></p>\n<ul>\n<li><a href=\"/kotlin/%E5%A6%82%E4%BD%95%E6%8E%A5API/#%E5%B0%87%E5%91%BC%E5%8F%AB-api-%E5%AF%AB%E6%88%90%E4%B8%80%E5%80%8B%E5%85%A8%E5%9F%9F%E5%AF%A6%E4%BE%8B\">å°‡å‘¼å« Api å¯«æˆä¸€å€‹å…¨åŸŸå¯¦ä¾‹</a></li>\n<li><a href=\"/kotlin/%E5%A6%82%E4%BD%95%E6%8E%A5API/#addinterceptor-%E6%94%94%E6%88%AA%E5%99%A8\">addInterceptor æ””æˆªå™¨</a></li>\n<li><a href=\"/kotlin/%E5%A6%82%E4%BD%95%E6%8E%A5API/#%E8%AB%8B%E6%B1%82%E6%8E%A5%E5%8F%A3-api-interface\">è«‹æ±‚æ¥å£ Api Interface</a></li>\n</ul>\n</li>\n<li><a href=\"/kotlin/%E5%A6%82%E4%BD%95%E6%8E%A5API/#2-%E5%AE%9A%E7%BE%A9%E8%B3%87%E6%96%99%E6%A0%BC%E5%BC%8F\">2. å®šç¾©è³‡æ–™æ ¼å¼</a></li>\n<li>\n<p><a href=\"/kotlin/%E5%A6%82%E4%BD%95%E6%8E%A5API/#3-%E5%9C%A8-activtiykt-%E5%AF%A6%E4%BD%9C%E6%8E%A5%E5%BE%8C%E7%AB%AF%E8%B3%87%E6%96%99%EF%BC%88%E7%95%B0%E6%AD%A5%E8%AB%8B%E6%B1%82%EF%BC%89\">3. åœ¨ Activtiy.kt å¯¦ä½œæ¥å¾Œç«¯è³‡æ–™ï¼ˆç•°æ­¥è«‹æ±‚ï¼‰</a></p>\n<ul>\n<li><a href=\"/kotlin/%E5%A6%82%E4%BD%95%E6%8E%A5API/#%E4%BD%BF%E7%94%A8-http-%E6%9C%83%E8%A2%AB-android-studio-%E6%93%8B%E4%B8%8B%E7%9A%84%E5%95%8F%E9%A1%8C\">ğŸ”¨ä½¿ç”¨ http æœƒè¢« Android Studio æ“‹ä¸‹çš„å•é¡Œ</a></li>\n<li><a href=\"/kotlin/%E5%A6%82%E4%BD%95%E6%8E%A5API/#tips\">Tips</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"æ–°æ‰‹ä¸Šè·¯ï¼Œå¦‚ä½•æ¥ API å‘¢ï¼Ÿ","date":"Nov 11, 2019","tags":["Kotlin","API"],"category":"Android","thumbnail":null}}},"pageContext":{"slug":"/kotlin/å¦‚ä½•æ¥API/","previous":{"fields":{"slug":"/note/é—œæ–¼å¥½æƒ³å·¥ä½œå®¤/"},"frontmatter":{"title":"å¥½æƒ³å·¥ä½œå®¤ï¼Œç©¶ç«Ÿæ˜¯ä¸€å€‹ä»€éº¼æ¨£çš„ç’°å¢ƒï¼Ÿè®“å‰µè¾¦äººå‘Šè¨´ä½ ","tags":["å¥½æƒ³å·¥ä½œå®¤"],"date":"2019-10-09","category":null,"mark":null,"description":null}},"next":{"fields":{"slug":"/kotlin/é–‹å•Ÿç›¸æ©Ÿæ¬Šé™/"},"frontmatter":{"title":"Android - æƒæ QR Code","tags":["Kotlin"],"date":"2019-11-26","category":"Android","mark":null,"description":"é–‹å•Ÿç›¸æ©Ÿæ¬Šé™åŠæƒç„åŠŸèƒ½"}}}},"staticQueryHashes":["63159454"]}