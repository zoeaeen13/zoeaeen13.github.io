{"componentChunkName":"component---src-templates-blog-post-js","path":"/kotlin/開啟相機權限/","result":{"data":{"site":{"siteMetadata":{"title":"Travel in Time.","author":"Zoe Yu"}},"markdownRemark":{"id":"9c27fcd6-615f-544f-ba1c-f7ec21763de9","excerpt":"正式挑戰賽要做物流中心，突然被 Don 要求送貨員是用 QR Code 來登記，花了一些時間弄相機權限和掃描，很菜哈哈！但至少在短時間弄出來了 如何開啟相機權限 首先在 Manifest 設定權限 因為 Android6.0 以上的版本，加強了隱私權設置，因此在操作 APP…","html":"<p>正式挑戰賽要做物流中心，突然被 Don 要求送貨員是用 QR Code 來登記，花了一些時間弄相機權限和掃描，很菜哈哈！但至少在短時間弄出來了</p>\n<p><strong>如何開啟相機權限</strong></p>\n<ol>\n<li>首先在 Manifest 設定權限</li>\n</ol>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"java\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;uses-permission android</span><span class=\"mtk4\">:</span><span class=\"mtk1\">name=</span><span class=\"mtk11\">&quot;android.permission.CAMERA&quot;</span><span class=\"mtk1\"> /&gt;</span></span></span></code></pre>\n<ol start=\"2\">\n<li>因為 Android6.0 以上的版本，加強了隱私權設置，因此在操作 APP 上，就必須讓使用者自行勾選是否開放這些權限</li>\n<li>進入頁面，判斷是否未取得權限，如果沒有就提醒使用者</li>\n<li>了解 <code class=\"language-text\">shouldShowRequestPermissionRationale</code> 用法，可以參考<a href=\"https://blog.csdn.net/cadi2011/article/details/71642355\">這篇</a>\n其屬於 AppCompact 裡，用於權限管理</li>\n</ol>\n<blockquote>\n<p>為了說明查找使用者可能需要解釋的情形，Android 提供了一個實用程式方法，即 shouldShowRequestPermissionRationale()。如果應用之前請求過此許可權但用戶拒絕了請求，此方法將返回 true。</p>\n</blockquote>\n<blockquote>\n<p>注：如果用戶在過去拒絕了許可權請求，並在許可權請求系統對話方塊中選擇了 Don’t ask again 選項，此方法將返回 false。如果設備規範禁止應用具有該許可權，此方法也會返回 false。\n包裝成 function，下次直接拿來用</p>\n</blockquote>\n<ul>\n<li><code class=\"language-text\">requestPermissions</code>用法</li>\n</ul>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"java\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">requestPermissions (activity</span><span class=\"mtk4\">:</span><span class=\"mtk1\"> Activity , permissions</span><span class=\"mtk4\">:</span><span class=\"mtk1\"> String, requestCode</span><span class=\"mtk4\">:</span><span class=\"mtk1\"> Int)</span></span></span></code></pre>\n<p>根據 requestCode 和 grantResults (授權結果)做相應的後續處理，了解<strong>權限處理</strong>可參考<a href=\"https://www.jianshu.com/p/b4a8b3d4f587\">這篇</a>，附上完整code，以後直接來拿來請求權限吧！</p>\n<p><strong>相機權限</strong></p>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"java\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">fun cameraPermission(){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">if</span><span class=\"mtk1\"> (ContextCompat.checkSelfPermission(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">.context!!,  Manifest.permission.CAMERA)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        != PackageManager.PERMISSION_GRANTED) {  </span><span class=\"mtk3\">//判斷是否未取得權限(!=)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">if</span><span class=\"mtk1\"> (ActivityCompat.shouldShowRequestPermissionRationale((activity as HomeActivity), </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        Manifest.permission.CAMERA)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            AlertDialog.Builder(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">.context!!)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .setMessage(</span><span class=\"mtk11\">&quot;我需要相機，給我權限吧？&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .setPositiveButton(</span><span class=\"mtk11\">&quot;OK&quot;</span><span class=\"mtk1\">) { _, _ </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">//跳出視窗，嘗試向使用者取得權限</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        ActivityCompat.requestPermissions(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        (activity as HomeActivity),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        arrayOf(Manifest.permission.CAMERA),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk4\">MY_PERMISSIONS_REQUEST_READ_CONTACTS</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .setNegativeButton(</span><span class=\"mtk11\">&quot;No&quot;</span><span class=\"mtk1\">) { _, _ </span><span class=\"mtk4\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    (activity as HomeActivity).finish() }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .show()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk4\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            ActivityCompat.requestPermissions((activity as HomeActivity),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                arrayOf(Manifest.permission.CAMERA, Manifest.permission.READ_EXTERNAL_STORAGE),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk4\">MY_PERMISSIONS_REQUEST_READ_CONTACTS</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"java\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">class</span><span class=\"mtk1\"> MissionFragment : Fragment() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    companion object {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> val MY_PERMISSIONS_REQUEST_READ_CONTACTS = </span><span class=\"mtk5\">100</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    override fun onRequestPermissionsResult(requestCode: Int,  </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    permissions: </span><span class=\"mtk4\">Array</span><span class=\"mtk1\">&lt;</span><span class=\"mtk4\">String</span><span class=\"mtk1\">&gt;, grantResults: IntArray) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        when (requestCode) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            MY_PERMISSIONS_REQUEST_READ_CONTACTS </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk4\">if</span><span class=\"mtk1\"> (grantResults.isNotEmpty() &amp;&amp; </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                grantResults[</span><span class=\"mtk5\">0</span><span class=\"mtk1\">] == PackageManager.PERMISSION_GRANTED) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                } </span><span class=\"mtk4\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    (activity as HomeActivity).finish()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk4\">return</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><strong>掃描功能</strong>\n調用 CaptureActivity 就可以實現掃碼功能，如果想進一步調整取景框的樣式，可以參考這篇 <a href=\"https://www.jianshu.com/p/d217c986c060\">Zxing 二維碼掃描和那些坑</a>，有機會實作再來補重點</p>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"java\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//qr_code: ImageView</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">qr_code.setOnClickListener {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    val intent = Intent(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">.context, CaptureActivity</span><span class=\"mtk4\">::</span><span class=\"mtk1\">class.java)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    startActivityForResult(intent,</span><span class=\"mtk5\">1</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>回傳解析結果</p>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"java\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">override fun onActivityResult(requestCode</span><span class=\"mtk4\">:</span><span class=\"mtk1\"> Int, resultCode</span><span class=\"mtk4\">:</span><span class=\"mtk1\"> Int, data</span><span class=\"mtk4\">:</span><span class=\"mtk1\"> Intent</span><span class=\"mtk4\">?</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">super</span><span class=\"mtk1\">.onActivityResult(requestCode, resultCode, data)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">if</span><span class=\"mtk1\"> (requestCode == </span><span class=\"mtk5\">1</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//处理扫描结果（在界面上显示）</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">null</span><span class=\"mtk1\"> != data) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            val bundle = data.getExtras();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk4\">if</span><span class=\"mtk1\"> (bundle == </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk4\">return</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk4\">if</span><span class=\"mtk1\"> (bundle.getInt(CodeUtils.RESULT_TYPE) == CodeUtils.RESULT_SUCCESS) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                val result = bundle.getString(CodeUtils.RESULT_STRING)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                Toast.makeText(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">.context, </span><span class=\"mtk11\">&quot;掃描：&quot;</span><span class=\"mtk1\"> + result, Toast.LENGTH_LONG).show()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .visual-studio-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .visual-studio-dark .mtk1 { color: #D4D4D4; }\n  .visual-studio-dark .mtk4 { color: #569CD6; }\n  .visual-studio-dark .mtk11 { color: #CE9178; }\n  .visual-studio-dark .mtk3 { color: #6A9955; }\n  .visual-studio-dark .mtk5 { color: #B5CEA8; }\n  .visual-studio-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"","frontmatter":{"title":"Android - 掃描 QR Code","date":"Nov 26, 2019","tags":["Kotlin"],"category":"Android","log":null,"thumbnail":null}}},"pageContext":{"slug":"/kotlin/開啟相機權限/","previous":{"fields":{"slug":"/kotlin/如何接API/"},"frontmatter":{"title":"新手上路，如何接 API 呢？","tags":["Kotlin","API"],"date":"2019-11-11","category":"Android","mark":null,"description":"學習從 Retrofit 2 下手","log":null}},"next":{"fields":{"slug":"/kotlin/實作第三方登入/"},"frontmatter":{"title":"Android - 實作第三方登入","tags":["Kotlin"],"date":"2020-02-11","category":"Android","mark":null,"description":"一次學會 Facebook、Google、Line 登入","log":null}}}},"staticQueryHashes":["63159454"]}