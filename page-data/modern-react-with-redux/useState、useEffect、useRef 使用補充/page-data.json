{"componentChunkName":"component---src-templates-blog-post-js","path":"/modern-react-with-redux/useStateã€useEffectã€useRef ä½¿ç”¨è£œå……/","result":{"data":{"site":{"siteMetadata":{"title":"Travel in Time.","author":"Zoe Yu"}},"markdownRemark":{"id":"e793890d-b683-5c22-9d2e-5d96c23f6169","excerpt":"Hooks æä¾› functional component å¯ä»¥æ“æœ‰ç‹€æ…‹ã€é¡ä¼¼ç”Ÿå‘½é€±æœŸçš„æ–¹æ³•  useState ä½¿ç”¨ array Destructuringï¼Œå¿«é€Ÿå­˜å–é™£åˆ—è£¡é¢çš„å…ƒç´  åªè¦èª¿ç”¨åˆ° setter functionï¼Œå…ƒä»¶å°±æœƒè§¸ç™¼ re-renderï¼Œè€Œ stateâ€¦","html":"<p>Hooks æä¾› functional component å¯ä»¥æ“æœ‰ç‹€æ…‹ã€é¡ä¼¼ç”Ÿå‘½é€±æœŸçš„æ–¹æ³•</p>\n<p><img src=\"https://i.imgur.com/qI4UX9i.png\"></p>\n<hr>\n<h4 id=\"useState\" style=\"position:relative;\">useState<a href=\"#useState\" aria-label=\"useState permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<ul>\n<li>ä½¿ç”¨ array Destructuringï¼Œå¿«é€Ÿå­˜å–é™£åˆ—è£¡é¢çš„å…ƒç´ </li>\n<li>åªè¦èª¿ç”¨åˆ° setter functionï¼Œå…ƒä»¶å°±æœƒè§¸ç™¼ re-renderï¼Œè€Œ state çš„åˆå§‹å€¼å°‡ä¸æœƒå†è¢«ä½¿ç”¨ï¼ˆé è¨­ nullï¼‰ï¼Œç›´æ¥è¢«æ–°å€¼å–ä»£</li>\n</ul>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"javascript\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> React, { useState } </span><span class=\"mtk4\">from</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;react&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> [activeIndex, setActiveIndex] = useState(</span><span class=\"mtk4\">null</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// ç¬¬ä¸€å€‹åƒæ•¸ï¼Œæ”¾æŸå€‹æœƒè¢« React ä¿ç•™çš„è®Šæ•¸å¼•ç”¨</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// ç¬¬äºŒå€‹åƒæ•¸ï¼Œæ˜¯ä¸€å€‹å¯ä»¥ç”¨ä¾†æ›´æ–°è©²è®Šæ•¸çš„ setter function</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// æ¥å—ä¸€å€‹åƒæ•¸ï¼Œä½œç‚º state åˆå§‹å€¼</span></span></span></code></pre>\n<p>class Component å¯ä»¥åŒæ™‚å®šç¾©å’Œæ›´æ”¹å¤šå€‹ç‹€æ…‹ï¼Œä½† functional component å»éœ€è¦å¤šæ¬¡èª¿ç”¨</p>\n<hr>\n<br>\n<h4 id=\"useEffect\" style=\"position:relative;\">useEffect<a href=\"#useEffect\" aria-label=\"useEffect permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"javascript\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">useEffect(() </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// è¦åŸ·è¡Œçš„ç¨‹å¼ç¢¼</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}, [])</span></span></span></code></pre>\n<p>æœ‰ä¸‰ç¨®æ–¹æ³•å¯ä»¥é…ç½® useEffect ä½¿ç”¨ï¼Œé”åˆ°ç”Ÿå‘½é€±æœŸçš„ä½œç”¨</p>\n<ol>\n<li>ç¬¬ä¸€æ¬¡æ¸²æŸ“å…ƒä»¶æ™‚åŸ·è¡Œ</li>\n<li>ç¬¬ä¸€æ¬¡æ¸²æŸ“æ™‚ã€æˆ–ä»»ä½•æ™‚å€™ re-render å®ŒåŸ·è¡Œï¼ˆä¸æ”¾ç¬¬äºŒå€‹åƒæ•¸ï¼‰</li>\n<li>ç¬¬ä¸€æ¬¡æ¸²æŸ“æ™‚ã€æˆ–åœ¨æŸäº›æ•¸æ“šæ”¹è®Šæ™‚æ‰åŸ·è¡Œ</li>\n</ol>\n<p><img src=\"https://i.imgur.com/dmzIXYt.png\"></p>\n<p>useEffect ç¬¬äºŒå€‹åƒæ•¸æ˜¯ä¸€é™£åˆ—ï¼Œè£¡é¢æ”¾çš„æ±è¥¿ä¸åŒï¼Œå°‡æ§åˆ¶ä»€éº¼æ™‚å€™åŸ·è¡Œç¨‹å¼ç¢¼ã€‚å¦‚æœæ”¾å¤šå€‹å…ƒç´ ï¼Œåªè¦ä»»ä¸€æ”¹è®Šå°±æœƒè§¸ç™¼</p>\n<hr>\n<BR>\n<h5 id=\"Q-useEffect-è£¡é¢æ”¾-async-functionï¼Ÿ\" style=\"position:relative;\">Q: useEffect è£¡é¢æ”¾ async functionï¼Ÿ<a href=\"#Q-useEffect-%E8%A3%A1%E9%9D%A2%E6%94%BE-async-function%EF%BC%9F\" aria-label=\"Q useEffect è£¡é¢æ”¾ async functionï¼Ÿ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h5>\n<p>æ³¨æ„ useEffect è¦åŸ·è¡Œçš„ç¨‹å¼ç¢¼ï¼Œä¸èƒ½ç›´æ¥å¯« async function</p>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"javascript\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> [term, setTerm] = useState(</span><span class=\"mtk11\">&#39;&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">useEffect(</span><span class=\"mtk4\">async</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">await</span><span class=\"mtk1\"> axios(</span><span class=\"mtk11\">&#39;XXX&#39;</span><span class=\"mtk1\">)... </span><span class=\"mtk3\">// ğŸ”´</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}, [term])</span></span></span></code></pre>\n<p>å¯é€éä»¥ä¸‹å¹¾ç¨®æ–¹å¼è§£æ±ºï¼š</p>\n<ol>\n<li>åœ¨ useEffect è£¡é¢å®šç¾©ä¸€å€‹ async function åŸ·è¡Œ</li>\n<li>æŠŠ async function è®Šæˆ IIFEï¼Œç«‹å³èª¿ç”¨ï¼ˆå’Œä¸Šé¢å·®ä¸å¤šï¼‰</li>\n<li>ä½¿ç”¨ Promise</li>\n</ol>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"javascript\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> [term, setTerm] = useState(</span><span class=\"mtk11\">&#39;&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// #1 è¨­ä¸€å€‹ helper function</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">useEffect(() </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> search = </span><span class=\"mtk4\">async</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">await</span><span class=\"mtk1\"> axios.get(</span><span class=\"mtk11\">&#39;XXX&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  search()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}, [term])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// #2 å’Œ #1 å·®ä¸å¤šï¼Œåªæ˜¯å°‘æ‰è®Šæ•¸å®£å‘Š</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">useEffect(() </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  (</span><span class=\"mtk4\">async</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">await</span><span class=\"mtk1\"> axios.get(</span><span class=\"mtk11\">&#39;XXX&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  })()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}, [term])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// #3 promise chain</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">useEffect(() </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  axios.get(</span><span class=\"mtk11\">&#39;XXX&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  .then((response) </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    console.log(response.data)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}, [term])</span></span></span></code></pre>\n<hr>\n<BR>\n<h5 id=\"Q-useEffect-çš„-cleanup-function-æ€éº¼ä½¿ç”¨ï¼Ÿ\" style=\"position:relative;\">Q: useEffect çš„ cleanup function æ€éº¼ä½¿ç”¨ï¼Ÿ<a href=\"#Q-useEffect-%E7%9A%84-cleanup-function-%E6%80%8E%E9%BA%BC%E4%BD%BF%E7%94%A8%EF%BC%9F\" aria-label=\"Q useEffect çš„ cleanup function æ€éº¼ä½¿ç”¨ï¼Ÿ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h5>\n<p>å¸¸ç¢°åˆ°ä¸€å€‹æƒ…å¢ƒï¼šä½¿ç”¨è€…åœæ­¢è¼¸å…¥å¾Œï¼Œå»¶é²å¹¾ç§’æ‰é€å‡ºæœå°‹ï¼Œé¿å…çŸ­æ™‚é–“ç™¼å‡ºå¤šå€‹ requestã€‚</p>\n<p>å»¶çºŒä¸Šé¢ä¾‹å­ï¼Œå¯ä»¥åœ¨ term æ”¹è®Šå¾Œè¨­å®šè¨ˆæ™‚å™¨ï¼Œæ¯ 500 æ¯«ç§’å» call ä¸€æ¬¡ API æœå°‹ï¼Œè€Œæµç¨‹æœƒåƒä¸‹åœ–ï¼Œç¬¬ä¸€æ¬¡ input æ”¹è®Šæ™‚è¨­å®šä¸€å€‹è¨ˆæ™‚ï¼Œç¬¬äºŒæ¬¡ input åœ¨ 500 æ¯«ç§’ä»¥å…§æ”¹è®Šå°±å–æ¶ˆä¸Šä¸€å€‹è¨ˆæ™‚ï¼Œé‡æ–°è¨­å®šä¸‹ä¸€å€‹â€¦</p>\n<p><img src=\"https://i.imgur.com/RAMXi8H.jpg\"></p>\n<p>ä½¿ç”¨ setTimeout å‰µå»ºè¨ˆæ™‚å™¨ï¼Œ setTimeout æœƒè¿”å›ä¸€å€‹æ•¸å­—æˆ–æ•´æ•¸æ¨™ç¤ºè¨ˆæ™‚å™¨ï¼Œå¯ä»¥åˆ©ç”¨ clearTimeout ä¾†æ¸…é™¤å®ƒï¼Œé€™æ¨£è£¡é¢çš„ç¨‹å¼ç¢¼å°±ä¸æœƒåŸ·è¡Œ</p>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"javascript\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">useEffect(() </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> search = </span><span class=\"mtk4\">async</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">await</span><span class=\"mtk1\"> axios.get(</span><span class=\"mtk11\">&#39;XXX&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// æ¯æ¬¡å»¶é² 500 ms ç™¼å‡ºè«‹æ±‚</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  setTimeout(() </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">if</span><span class=\"mtk1\"> (term) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      search()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }, </span><span class=\"mtk5\">500</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}, [term])</span></span></span></code></pre>\n<p><strong>ä½†æ˜¯ï¼Œæ¸…é™¤çš„æ™‚æ©Ÿé»æ˜¯ä»€éº¼ï¼Ÿ</strong></p>\n<p>åœ¨ useEffect è£¡é¢ï¼Œåªèƒ½å›å‚³ä¸€å€‹ç‰¹å®šé¡å‹çš„å€¼ï¼Œå°±æ˜¯ functionï¼Œä¹Ÿæ˜¯æ‰€è¬‚çš„æ¸…ç†å‡½æ•¸ <code class=\"language-text\">cleanup function</code>ï¼Œè€Œå®ƒçš„æ¸…ç†åŠŸèƒ½</p>\n<ul>\n<li>æœƒåœ¨å…ƒä»¶å¾ UI ä¸­ç§»é™¤ä¹‹å‰é‹è¡Œ</li>\n<li>å…ƒä»¶æ¸²æŸ“å¤šæ¬¡æ™‚ï¼Œæ¯æ¬¡åŸ·è¡Œ useEffect ä¸»è¦ç¨‹å¼ç¢¼ä¹‹å‰æœƒé‹è¡Œ</li>\n</ul>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"javascript\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">useEffect(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// main function</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> search = </span><span class=\"mtk4\">async</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">await</span><span class=\"mtk1\"> axios.get(</span><span class=\"mtk11\">&#39;XXX&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> timeoutId = setTimeout(() </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">if</span><span class=\"mtk1\"> (term) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      search()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }, </span><span class=\"mtk5\">500</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// cleanup function</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">return</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    clearTimeout(timeoutId)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}, [term])</span></span></span></code></pre>\n<p>ç¬¬ä¸€æ¬¡æ¸²æŸ“æ™‚ï¼ŒæœƒåŸ·è¡Œæ•´å€‹ arrow function çš„å…§å®¹ï¼Œä¸¦ return ä¸€å€‹æ¸…ç†å‡½æ•¸ï¼ŒReact æœƒå°‡æ¸…ç†å‡½æ•¸ä¿ç•™èµ·ä¾†ã€‚</p>\n<p>ç•¶è¦å†æ¬¡åŸ·è¡Œ arrow function å…§å®¹æ™‚ï¼ŒReact æœƒå…ˆèª¿ç”¨æ¸…ç†å‡½æ•¸ï¼ˆç¬¬ä¸€æ¬¡åŸ·è¡Œæ™‚è¿”å›çš„æ±è¥¿ï¼‰ï¼Œæ¥è‘—æ‰åŸ·è¡Œ arrow functionï¼Œç„¶å¾Œå›å‚³æ¸…ç†å‡½æ•¸ï¼Œé †åºå¦‚ä¸‹</p>\n<p><img src=\"https://i.imgur.com/EsMAc3m.png\"></p>\n<hr>\n<BR>\n<h4 id=\"useRef-ä½¿ç”¨\" style=\"position:relative;\">useRef ä½¿ç”¨<a href=\"#useRef-%E4%BD%BF%E7%94%A8\" aria-label=\"useRef ä½¿ç”¨ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>åˆ©ç”¨ Refs ç³»çµ±ï¼Œè¨ªå•ç”± JSX æ‰€ç”¢ç”ŸçœŸæ­£çš„ DOM elementï¼Œä»£æ›¿ <code class=\"language-text\">document.querySelector</code> ä½¿ç”¨ã€‚</p>\n<p>ref æ˜¯ä¸€å€‹ JS ç‰©ä»¶ï¼Œæœ‰ä¸€å€‹ current å±¬æ€§æœƒæŒ‡å‘å…¶ç¶å®šçš„ DOM ç¯€é»ï¼Œä¹‹å‰åœ¨ class componenet è£¡é¢å°±æ˜¯ç”¨ <code class=\"language-text\">React.createRef()</code> è¨­å®šï¼Œåœ¨ Hooks è£¡é¢ä¹Ÿæœ‰æä¾›é¡ä¼¼çš„ useRef æ–¹æ³•ã€‚</p>\n<p>ä»¥è¨­è¨ˆä¸‹æ‹‰é¸å–®ç‚ºä¾‹ï¼Œå¯¦ä½œé»æ“Šé é¢å…¶ä»–éƒ¨åˆ†è¦æ”¶èµ·é¸å–®ï¼š\né¦–å…ˆï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸‹æ‹‰å…ƒä»¶æ™‚ï¼Œåœ¨ useEffect ç‚º body æ·»åŠ  click äº‹ä»¶ç›£è½ï¼Œç†æƒ³ä¾†èªªï¼Œç•¶äº‹ä»¶æœ€å¾Œå†’æ³¡åˆ° body å°±æœƒåŸ·è¡Œé—œé–‰é¸å–®ï¼Ÿ</p>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"javascript\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">useEffect(() </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    document.body.addEventListener(</span><span class=\"mtk11\">&#39;click&#39;</span><span class=\"mtk1\">, () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        setOpen(</span><span class=\"mtk4\">false</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}, [])</span></span></span></code></pre>\n<p>ç„¶è€Œï¼ŒDropdown å…ƒä»¶ä¸­æœƒåŸ·è¡Œåˆ° setOpen çš„é‚„æœ‰å…¶ä»–é»æ“Šäº‹ä»¶ï¼Œä»¥ç‚ºæ˜¯æŒ‰ç…§å†’æ³¡çš„é †åºç”±ä¸‹å¾€ä¸Šå‚³éï¼Œä½†å¯¦éš›é †åºå»å’Œæƒ³åƒä¸å¤ªä¸€æ¨£ã€‚</p>\n<blockquote>\n<p>å› åŸ·è¡Œé †åºå•é¡Œï¼Œç«Ÿç„¶ç™¼ç”Ÿåˆæ‰“é–‹é¸å–®çš„ç‹€æ³ï¼Ÿ</p>\n</blockquote>\n<p><strong>åœ¨ JSX å…ƒä»¶ä¸Šé¢ç¶çš„ç›£è½å™¨ï¼Œæ˜¯é€šé react ä¾†é€£çµï¼Œä½¿ç”¨åŸç”Ÿ JS å¯«æ³•é€£çµçš„äº‹ä»¶åè€Œæœ€å…ˆè¢«èª¿ç”¨</strong>ï¼Œæ‰€ä»¥æ­£ç¢ºåŸ·è¡Œé †åºå¦‚ä¸‹ï¼Œç•¶é»æ“Š Dropdown é¸é …æ™‚ï¼š</p>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"javascript\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">1</span><span class=\"mtk1\"> ç”¨ addEventListenr ç¶å®šçš„äº‹ä»¶</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">2</span><span class=\"mtk1\"> å­å…ƒä»¶ç¶å®šçš„ click äº‹ä»¶</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">3</span><span class=\"mtk1\"> çˆ¶å…ƒä»¶ç¶å®šçš„ click äº‹ä»¶</span></span></span></code></pre>\n<p><img src=\"https://i.imgur.com/GELW4iO.png\"></p>\n<p>æ‰€ä»¥ï¼Œè¦æ’é™¤ body click çš„æŸäº›æƒ…æ³ï¼Œå¯ä»¥ä½¿ç”¨ useRef åƒç…§å…¶ DOM å…ƒç´ </p>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"javascript\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">useEffect(() </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  document.body.addEventListener(</span><span class=\"mtk11\">&#39;click&#39;</span><span class=\"mtk1\">, (event) </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// ç¢ºèªç›®å‰é»æ“Šçš„å…ƒç´ æ˜¯å¦åœ¨ Dropdown è£¡</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">if</span><span class=\"mtk1\"> (dropDownRef.current.contains(event.target)) </span><span class=\"mtk4\">return</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    setOpen(</span><span class=\"mtk4\">false</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">})</span></span></span></code></pre>\n<p>ä¸éè¦æ³¨æ„ç›£è½å™¨çš„æ¸…ç†ï¼Œç•¶å…ƒä»¶å¾ DOM ä¸Šæ¶ˆå¤±æ™‚ï¼Œæ‰€æœ‰æ·»åŠ åˆ°å…§éƒ¨å…ƒç´ çš„ ref æœƒè¢«è¨­å®šæˆ nullï¼ˆå› ç‚ºæ²’æœ‰æ±è¥¿å¯ä»¥å¼•ç”¨äº†ï¼‰ï¼Œä½†æ˜¯ç›£è½å™¨ä»ç„¶å­˜åœ¨ï¼Œå¯èƒ½æœƒé€ æˆ <code class=\"language-text\">null.current.contains</code> çš„éŒ¯èª¤ç‹€æ³</p>\n<p>è¨˜å¾—åˆ©ç”¨ä¸Šé¢æåˆ°çš„ useEffect æ¸…ç†åŠŸèƒ½ï¼Œç•¶å…ƒä»¶å¾ç•«é¢ä¸Šç§»æ‰æ™‚ï¼Œé—œé–‰ç›£è½å™¨</p>\n<pre class=\"grvsc-container visual-studio-dark\" data-language=\"javascript\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">useEffect(() </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> onBodyClick = (event) </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">if</span><span class=\"mtk1\"> (dropDownRef.current.contains(event.target)) </span><span class=\"mtk4\">return</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        setOpen(</span><span class=\"mtk4\">false</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    document.body.addEventListener(</span><span class=\"mtk11\">&#39;click&#39;</span><span class=\"mtk1\">, onBodyClick)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// cleanup function</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">return</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        document.body.removeEventListener(</span><span class=\"mtk11\">&#39;click&#39;</span><span class=\"mtk1\">, onBodyClick)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">})</span></span></span></code></pre>\n<blockquote>\n<h6 id=\"PS-è£œå……\" style=\"position:relative;\">P.S è£œå……<a href=\"#PS-%E8%A3%9C%E5%85%85\" aria-label=\"PS è£œå…… permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h6>\n<p>React v17 ä¹‹å¾Œï¼Œç›£è½å™¨è¦åŠ ä¸Šç¬¬ä¸‰å€‹åƒæ•¸ => <code class=\"language-text\">{ capture: true }</code>ï¼Œåƒè€ƒ <a href=\"https://reactjs.org/blog/2020/08/10/react-v17-rc.html#fixing-potential-issues\">Fixing Potential Issues</a></p>\n</blockquote>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .visual-studio-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .visual-studio-dark .mtk4 { color: #569CD6; }\n  .visual-studio-dark .mtk1 { color: #D4D4D4; }\n  .visual-studio-dark .mtk11 { color: #CE9178; }\n  .visual-studio-dark .mtk3 { color: #6A9955; }\n  .visual-studio-dark .mtk5 { color: #B5CEA8; }\n  .visual-studio-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li><a href=\"/modern-react-with-redux/useState%E3%80%81useEffect%E3%80%81useRef%20%E4%BD%BF%E7%94%A8%E8%A3%9C%E5%85%85/#usestate\">useState</a></li>\n<li>\n<p><a href=\"/modern-react-with-redux/useState%E3%80%81useEffect%E3%80%81useRef%20%E4%BD%BF%E7%94%A8%E8%A3%9C%E5%85%85/#useeffect\">useEffect</a></p>\n<ul>\n<li><a href=\"/modern-react-with-redux/useState%E3%80%81useEffect%E3%80%81useRef%20%E4%BD%BF%E7%94%A8%E8%A3%9C%E5%85%85/#q-useeffect-%E8%A3%A1%E9%9D%A2%E6%94%BE-async-function%EF%BC%9F\">Q: useEffect è£¡é¢æ”¾ async functionï¼Ÿ</a></li>\n<li><a href=\"/modern-react-with-redux/useState%E3%80%81useEffect%E3%80%81useRef%20%E4%BD%BF%E7%94%A8%E8%A3%9C%E5%85%85/#q-useeffect-%E7%9A%84-cleanup-function-%E6%80%8E%E9%BA%BC%E4%BD%BF%E7%94%A8%EF%BC%9F\">Q: useEffect çš„ cleanup function æ€éº¼ä½¿ç”¨ï¼Ÿ</a></li>\n</ul>\n</li>\n<li><a href=\"/modern-react-with-redux/useState%E3%80%81useEffect%E3%80%81useRef%20%E4%BD%BF%E7%94%A8%E8%A3%9C%E5%85%85/#useref-%E4%BD%BF%E7%94%A8\">useRef ä½¿ç”¨</a></li>\n</ul>","frontmatter":{"title":"CH12ï¼šuseStateã€useEffectã€useRef ä½¿ç”¨è£œå……","type":"coding","date":"Jul 09, 2021","tags":["React","Udemy"],"category":"Modern React with Redux","log":null,"thumbnail":null}}},"pageContext":{"slug":"/modern-react-with-redux/useStateã€useEffectã€useRef ä½¿ç”¨è£œå……/","previous":{"fields":{"slug":"/modern-react-with-redux/ä¸€äº›å…ƒä»¶è¨­å®šèˆ‡äº‹ä»¶ç¶å®šçš„æŠ€å·§/"},"frontmatter":{"title":"ä¸€äº› React å…ƒä»¶è¨­å®šèˆ‡äº‹ä»¶ç¶å®šçš„æŠ€å·§","tags":["React","Udemy"],"date":"2021-06-19","category":"Modern React with Redux","mark":null,"description":"åˆå§‹åŒ– stateã€è¨­ default propsã€è™•ç† this ç­‰ç­‰å•é¡Œ","log":"log"}},"next":null}},"staticQueryHashes":["63159454"]}